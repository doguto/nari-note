# 残タスク調査結果

## 調査日時
2026年2月15日

## プロジェクト概要
nari-noteは、将棋記事の投稿・共有プラットフォームです。
- **バックエンド**: ASP.NET Core 9.0 + PostgreSQL 16
- **フロントエンド**: Next.js 15 + TypeScript + React 19
- **アーキテクチャ**: モノリポ構成、レイヤードアーキテクチャ（バックエンド）、Atomic Design（フロントエンド）

## 調査方法
1. spec/ディレクトリの仕様書（.spec）ファイルを確認
2. バックエンドの実装状況を確認（Controller, Service, Entity, Repository）
3. フロントエンドの実装状況を確認（pages, features, components, API client）
4. コーディング規約、セキュリティ、テストコードの状況を確認

---

## 🔴 重要度：高（早急に対応が必要）

### 1. 通知機能の完全実装
**状況**: エンティティは定義されているが、機能として完成していない

**バックエンド**:
- ❌ 通知作成ロジックが未実装（フォローユーザーの記事投稿時に通知を作成する機能）
- ❌ 通知取得APIエンドポイントが未実装
- ❌ 通知既読管理APIが未実装
- ✅ Notificationエンティティは定義済み

**フロントエンド**:
- ❌ 通知アイコン・バッジ表示が未実装
- ❌ 通知ドロップダウンUIが未実装
- ❌ 通知ページ（/notifications）が未実装
- ❌ 既読/未読管理UIが未実装

**仕様書**: `spec/notification.spec`
- 直近1ヶ月の通知を新着順で20件表示
- 通知一覧を開くと自動既読化
- バッジに未読数を表示
- 通知ページでページネーション対応

**必要な作業**:
1. バックエンド：NotificationController、NotificationServiceの実装
2. バックエンド：CreateArticleServiceに通知作成ロジック追加
3. フロントエンド：通知アイコン・バッジをHeaderに追加
4. フロントエンド：通知ドロップダウンコンポーネント作成
5. フロントエンド：通知ページ（/notifications）作成
6. フロントエンド：通知API連携実装

---

### 2. Google OAuth認証機能の実装
**状況**: 完全に未実装

**バックエンド**:
- ❌ Google OAuth認証エンドポイントが未実装
- ❌ Google OAuth Callbackエンドポイントが未実装
- ✅ メールアドレス/パスワード認証は実装済み

**フロントエンド**:
- ❌ ログインページにGoogleサインインボタンが未実装
- ❌ サインアップページにGoogleサインインボタンが未実装

**仕様書**: `spec/signin.spec`（8行目）、`spec/signup.spec`
- Googleでサインインボタンを表示
- Google認証画面への遷移
- 初回認証時の自動アカウント作成
- 既存アカウントへのログイン

**必要な作業**:
1. バックエンド：Google OAuth 2.0の設定とエンドポイント実装
2. バックエンド：Google認証情報とユーザーアカウントの紐付け
3. フロントエンド：GoogleサインインボタンコンポーネントとOAuthフロー実装
4. 環境変数の設定（Google Client ID, Client Secret）

---

### 3. テストコードの実装
**状況**: テストコードが存在しない

**バックエンド**:
- ❌ Test/またはTests/ディレクトリが存在しない
- ❌ Unitテストが未実装
- ❌ Integrationテストが未実装

**フロントエンド**:
- ❌ __tests__/ディレクトリが存在しない
- ❌ .test.tsファイルが存在しない
- ❌ Unitテストが未実装
- ❌ E2Eテストが未実装

**必要な作業**:
1. バックエンド：xUnit + Moqのセットアップ
2. バックエンド：Service層のUnitテスト作成
3. バックエンド：Repository層のIntegrationテスト作成
4. フロントエンド：Jest + React Testing Libraryのセットアップ
5. フロントエンド：コンポーネントのUnitテスト作成
6. フロントエンド：Playwright等を使用したE2Eテストの検討

---

## 🟡 重要度：中（優先度を持って対応すべき）

### 4. パスワードリセット機能の実装
**状況**: リンクは存在するが機能が未実装

**バックエンド**:
- ❌ パスワードリセット用APIエンドポイントが未実装
- ❌ パスワードリセットトークン生成・検証ロジックが未実装
- ❌ メール送信機能が未実装

**フロントエンド**:
- ✅ ログインページに「パスワード忘れ」リンクは存在
- ❌ パスワードリセットページ（/password-reset等）が未実装
- ❌ パスワードリセットフローが未実装

**仕様書**: `spec/signin.spec`（102-108行目）
- パスワード忘れリンクをクリックするとパスワードリセットページに遷移

**必要な作業**:
1. バックエンド：パスワードリセットトークンの生成・管理
2. バックエンド：メール送信機能の実装（SMTP設定）
3. バックエンド：パスワードリセットAPIエンドポイント実装
4. フロントエンド：パスワードリセット申請ページ作成
5. フロントエンド：パスワードリセット実行ページ作成

---

### 5. 記事編集の自動保存機能
**状況**: 未実装

**フロントエンド**:
- ✅ 手動保存機能は実装済み
- ✅ 未保存変更の検出機能は実装済み
- ❌ 一定時間経過での自動保存が未実装

**仕様書**: `spec/article-edit.spec`（87-92行目）
- 一定時間が経過すると編集内容が自動保存される

**必要な作業**:
1. フロントエンド：タイマーによる自動保存ロジックの実装（useEffectとdebounce）
2. フロントエンド：自動保存の成功/失敗フィードバックUI
3. フロントエンド：自動保存のインジケーター表示

---

### 6. 棋譜再生機能の完全実装
**状況**: 盤面表示は実装済みだが、棋譜再生機能が未完成

**バックエンド**:
- ❌ 棋譜データを保存するフィールドが未定義

**フロントエンド**:
- ✅ 盤面挿入機能は実装済み（BOD形式）
- ✅ 盤面表示機能は実装済み
- ❌ 棋譜フォーマット挿入機能が未実装
- ❌ 棋譜再生コントロール（再生・一時停止・コマ送り等）が未実装

**仕様書**: `spec/article.spec`（14-18行目）、`spec/article-edit.spec`（28行目、74行目）
- 記事に棋譜を埋め込み可能
- 再生ボタンを押すと棋譜の再生が始まる

**必要な作業**:
1. バックエンド：Articleエンティティに棋譜データフィールドを追加（必要に応じて）
2. フロントエンド：棋譜フォーマット（KIF/KIF+）のパーサー実装
3. フロントエンド：棋譜再生コントロールUI実装（再生・一時停止・コマ送り・巻き戻し）
4. フロントエンド：棋譜埋め込みのエディタUIの実装

---

### 7. Atomic Design構造の整理
**状況**: 部分的に実装されているが構造が不完全

**フロントエンド**:
- ⚠️ `components/common/atoms/`ディレクトリが存在しない
- ⚠️ Atoms/Moleculesの分類が明確でない部分がある
- ✅ Organisms（features/*/organisms/）は実装されている

**必要な作業**:
1. `components/common/atoms/`ディレクトリの作成
2. 基本的なUI要素（Button, Input, Label等）をAtomsとして整理
3. 機能単位のコンポーネント（FormField等）をMoleculesとして整理
4. 実装ガイド（docs/implementation-guide.md）に沿った構造への整理

---

### 8. エラーハンドリングUIの強化
**状況**: バックエンドは完全だがフロントエンドが最小限

**フロントエンド**:
- ❌ ErrorBoundaryコンポーネントが未実装
- ⚠️ 共通エラーメッセージコンポーネントの確認が必要
- ❌ エラー表示の統一的なデザインシステムが未確立

**必要な作業**:
1. ErrorBoundaryコンポーネントの実装
2. 共通エラーメッセージコンポーネントの確認・改善
3. エラー表示の統一的なデザインガイドライン作成
4. API呼び出し時のエラーハンドリングパターンの統一

---

## 🟢 重要度：低（改善したい項目）

### 9. XSS対策の強化
**状況**: 基本的なセキュリティは実装済みだが、XSS対策の確認が必要

**フロントエンド**:
- ⚠️ Tiptap（リッチテキストエディタ）のサニタイズ設定を確認
- ⚠️ DOMPurifyの導入を検討
- ⚠️ dangerouslySetInnerHTMLの使用状況を確認

**必要な作業**:
1. Tiptapのサニタイズ設定の確認と強化
2. DOMPurifyライブラリの導入検討
3. XSS攻撃のテストケース作成

---

### 10. CI/CD パイプラインの拡充
**状況**: Claude Code用のワークフローのみ存在

**現在の状況**:
- ✅ Claude Code Action: 実装済み（.github/workflows/claude.yml）
- ❌ ビルド・テストの自動化が未実装
- ❌ Linterの自動実行が未実装
- ❌ デプロイパイプラインが未実装

**必要な作業**:
1. GitHub Actions：ビルド自動化（バックエンド・フロントエンド）
2. GitHub Actions：テスト自動化（テストコード実装後）
3. GitHub Actions：Linter自動実行
4. GitHub Actions：デプロイパイプライン（Staging/Production）
5. GitHub Actions：依存関係の脆弱性スキャン

---

### 11. パフォーマンス最適化
**状況**: 初期実装完了、最適化は未着手

**バックエンド**:
- ⚠️ N+1クエリ問題の確認（Include/ThenIncludeの適切な使用）
- ⚠️ ページネーションのパフォーマンス確認
- ⚠️ キャッシュ戦略の検討（Redis等）

**フロントエンド**:
- ⚠️ コードスプリッティングの最適化
- ⚠️ 画像の最適化（Next.js Image）
- ⚠️ メモ化（useMemo, useCallback）の適切な使用

**必要な作業**:
1. バックエンド：データベースクエリのパフォーマンス分析
2. バックエンド：キャッシュ戦略の検討と実装
3. フロントエンド：Lighthouseスコアの測定と改善
4. フロントエンド：バンドルサイズの分析と最適化

---

### 12. アクセシビリティ対応
**状況**: 未着手

**必要な作業**:
1. WAI-ARIA属性の適切な使用
2. キーボード操作のサポート
3. スクリーンリーダー対応
4. コントラスト比の確認
5. フォーカス管理の改善

---

### 13. ドキュメントの充実
**状況**: 基本的なドキュメントは存在するが、一部不足

**現在のドキュメント**:
- ✅ README.md（プロジェクト概要）
- ✅ AGENTS.md（エージェント向けガイド）
- ✅ バックエンドドキュメント（Documents/）
- ✅ フロントエンドドキュメント（docs/）

**不足しているドキュメント**:
- ❌ API仕様書（OpenAPI/Swagger）
- ❌ デプロイ手順書
- ❌ トラブルシューティングガイド
- ❌ コントリビューションガイド

**必要な作業**:
1. OpenAPI/Swagger仕様書の作成
2. デプロイ手順書の作成
3. トラブルシューティングガイドの作成
4. コントリビューションガイドの作成

---

## データベーススキーマの確認事項

### 現在のエンティティ
- ✅ User（ユーザー）
- ✅ Article（記事）
- ✅ Tag（タグ）
- ✅ ArticleTag（記事とタグの関連）
- ✅ Like（いいね）
- ✅ Follow（フォロー）
- ✅ Comment（コメント）
- ✅ Notification（通知）
- ✅ Course（コース）
- ✅ CourseLike（コースいいね）

### スキーマの課題
1. **Article.Body**: 現在の最大長10,000文字は仕様書（50,000文字）と不一致
   - 仕様書: `spec/article-edit.spec`（50,000文字まで入力可能）
   - 実装: `Article.Body` は `MaxLength(10000)`
2. **棋譜データ**: 棋譜を保存するための専用フィールドが未定義（必要に応じて）

---

## まとめ

### 優先度別タスク数
- 🔴 重要度：高 - **3件**（通知機能、Google OAuth、テストコード）
- 🟡 重要度：中 - **5件**（パスワードリセット、自動保存、棋譜再生、Atomic Design、エラーハンドリング）
- 🟢 重要度：低 - **5件**（XSS対策、CI/CD、パフォーマンス、アクセシビリティ、ドキュメント）

### 推奨される対応順序
1. **通知機能の完全実装** - エンティティは準備済み、APIとUIの実装
2. **テストコードの実装** - 品質保証のための基盤整備
3. **Google OAuth認証** - ユーザー体験向上のための必須機能
4. **パスワードリセット機能** - セキュリティ要件
5. **記事本文の最大長修正** - 仕様書との整合性
6. その他の機能（自動保存、棋譜再生、Atomic Design整理等）

### 全体的な評価
- ✅ **基本機能は実装済み**: 認証、記事CRUD、ユーザープロフィール、フォロー、いいね、タグ等
- ⚠️ **仕様書との不整合**: 通知、Google OAuth、パスワードリセット、棋譜再生が未完成
- ⚠️ **品質保証**: テストコードが存在せず、CI/CDパイプラインも最小限
- ✅ **セキュリティ**: JWT認証、CORS、SQLインジェクション対策は実装済み
- ⚠️ **コード品質**: コーディング規約は概ね遵守、Atomic Design構造は要整理
