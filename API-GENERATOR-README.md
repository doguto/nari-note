# API Generator

このスクリプトは、バックエンドのC#コード（Controllers, Request, Response）からフロントエンド用のTypeScript API関数を生成します。

## 使用方法

### 1. ジェネレーターの実行

```bash
python3 api-generator.py
```

### 2. 生成されるファイル

スクリプトを実行すると、以下のファイルが生成されます：

- `nari-note-frontend/src/lib/api/types.ts` - TypeScript型定義
- `nari-note-frontend/src/lib/api/endpoints.ts` - API関数
- `nari-note-frontend/src/lib/api/hooks.ts` - TanStack Queryフックのテンプレート

**注意**: 生成されたファイルは直接gitにコミットされます。必要に応じて手動で調整してください。

### 3. 生成されたファイルの確認と調整

生成されたファイルを確認し、必要に応じて手動で調整してください。

**調整が必要な項目：**
- プロパティのオプショナル（`?`）の判定
- 複雑な型（ネストされたオブジェクト、Union型など）
- APIエンドポイントのパラメータ（パスパラメータ、クエリパラメータ）
- TanStack Queryフックの実装

## 設計思想

### なぜ完全自動生成ではないのか？

このジェネレーターは**骨組みの生成**に焦点を当てています：

1. **C#のパースの複雑性**: C#の完全なパースには専用のパーサーが必要で、正規表現では限界がある
2. **型の推論**: オプショナルかどうかの判定、デフォルト値の扱いなど、コンテキストが必要
3. **API設計の柔軟性**: 各エンドポイントで必要な処理が異なる（認証、エラーハンドリングなど）
4. **カスタマイズの必要性**: プロジェクト固有のロジックや命名規則への対応

### 推奨ワークフロー

1. **初回生成**: `api-generator.py`を実行して骨組みを生成
2. **レビュー**: 生成されたファイルを確認し、不足している情報を手動で補完
3. **コミット**: 調整したファイルをgitにコミット
4. **更新時**: バックエンドに変更があった場合、再度ジェネレーターを実行して差分を確認

## 実装の詳細

### パース処理

- **Request/Responseクラス**: 正規表現でプロパティを抽出
- **Controllers**: HTTPメソッドとルートを抽出
- **型変換**: C#の型をTypeScriptの型にマッピング

### 制限事項

現在のバージョンでは以下の制限があります：

- ネストされたクラスには非対応
- 複雑な型（Union型、Intersection型など）には非対応
- パスパラメータとクエリパラメータの自動検出は部分的
- ジェネリック型の完全なサポートは未実装

### 拡張方法

必要に応じて、以下の機能を追加できます：

1. **Roslyn APIの使用**: C#の構文木を正確にパースする
2. **OpenAPI/Swaggerの活用**: バックエンドからOpenAPI仕様を生成し、それを元に型を生成
3. **テンプレートエンジンの使用**: より柔軟なコード生成

## トラブルシューティング

### 型が正しく生成されない

→ 生成された `.ts` ファイルを確認し、手動で調整してください。特に：
- プロパティの型
- オプショナル（`?`）の有無
- 配列型

### エンドポイントが見つからない

→ コントローラーの命名規則を確認してください。`[HttpGet]`、`[HttpPost]`などの属性が正しく設定されているか確認。

### ビルドエラーが発生する

→ 生成されたファイルのTypeScript構文を確認してください。必要に応じて手動で修正。

## 参考

- 既存の手動実装: `nari-note-frontend/src/lib/api/`
- バックエンドコード: `nari-note-backend/Src/`
- ドキュメント: `docs/frontend-api-usage.md`
