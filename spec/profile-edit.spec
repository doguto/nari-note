Feature "プロフィール編集機能" do
  Scenario "プロフィール編集ページの表示" do
    Given "ログイン状態のとき" do
      When "プロフィール編集ページにアクセスすると、" do
        Then "ユーザー名入力欄が表示される"
          .And "表示名入力欄が表示される"
          .And "自己紹介文入力欄が表示される"
          .And "アイコン画像のアップロードエリアが表示される"
          .And "現在のアイコン画像が表示される"
          .And "保存ボタンが表示される"
          .And "キャンセルボタンが表示される"
      end
    end
  end

  Scenario "ユーザー名の編集" do
    Given "プロフィール編集ページにアクセスしているとき" do
      When "ユーザー名を変更して保存ボタンをクリックすると、" do
        Then "ユーザー名が更新される"
          .And "プロフィールページに遷移する"
          .And "更新成功のメッセージが表示される"
      end
    end
  end

  Scenario "ユーザー名のバリデーション" do
    Given "プロフィール編集ページにアクセスしているとき" do
      When "ユーザー名を空欄にして保存しようとすると、" do
        Then "ユーザー名が必須であるエラーメッセージが表示される"
          .And "保存が実行されない"
      end

      When "既に使用されているユーザー名を入力して保存しようとすると、" do
        Then "このユーザー名は既に使用されているエラーメッセージが表示される"
          .And "保存が実行されない"
      end

      When "ユーザー名に使用できない文字を含めて保存しようとすると、" do
        Then "ユーザー名は英数字とアンダースコアのみ使用可能であるエラーメッセージが表示される"
          .And "保存が実行されない"
      end

      When "ユーザー名が3文字未満で保存しようとすると、" do
        Then "ユーザー名は3文字以上である必要があるエラーメッセージが表示される"
          .And "保存が実行されない"
      end
    end
  end

  Scenario "表示名の編集" do
    Given "プロフィール編集ページにアクセスしているとき" do
      When "表示名を変更して保存ボタンをクリックすると、" do
        Then "表示名が更新される"
          .And "プロフィールページに遷移する"
          .And "更新成功のメッセージが表示される"
      end
    end
  end

  Scenario "表示名のバリデーション" do
    Given "プロフィール編集ページにアクセスしているとき" do
      When "表示名が20文字を超えて保存しようとすると、" do
        Then "表示名は20文字以内である必要があるエラーメッセージが表示される"
          .And "保存が実行されない"
      end
    end
  end

  Scenario "自己紹介文の編集" do
    Given "プロフィール編集ページにアクセスしているとき" do
      When "自己紹介文を変更して保存ボタンをクリックすると、" do
        Then "自己紹介文が更新される"
          .And "プロフィールページに遷移する"
          .And "更新成功のメッセージが表示される"
      end

      When "自己紹介文を空欄にして保存ボタンをクリックすると、" do
        Then "自己紹介文が空の状態で更新される"
          .And "プロフィールページに遷移する"
      end
    end
  end

  Scenario "自己紹介文のバリデーション" do
    Given "プロフィール編集ページにアクセスしているとき" do
      # STRING型の最大長が255であるため、250文字に設定
      When "自己紹介文が250文字を超えて保存しようとすると、" do
        Then "自己紹介文は250文字以内である必要があるエラーメッセージが表示される"
          .And "保存が実行されない"
      end
    end
  end

  Scenario "アイコン画像のアップロード" do
    Given "プロフィール編集ページにアクセスしているとき" do
      When "画像ファイルを選択してアップロードすると、" do
        Then "プレビューが表示される"
      end
    end
  end

  Scenario "アイコン画像のバリデーション" do
    Given "プロフィール編集ページにアクセスしているとき" do
      When "画像以外のファイルをアップロードしようとすると、" do
        Then "画像ファイルのみアップロード可能であるエラーメッセージが表示される"
          .And "アップロードが実行されない"
      end

      When "5MBを超える画像をアップロードしようとすると、" do
        Then "ファイルサイズは5MB以下である必要があるエラーメッセージが表示される"
          .And "アップロードが実行されない"
      end
    end
  end

  Scenario "プロフィール画像の削除" do
    Given "プロフィール編集ページにアクセスしているとき" do
      Given "プロフィール画像が設定されているとき" do
        When "画像削除ボタンをクリックすると、" do
          Then "画像削除の確認モーダルが表示される"
        end

        When "確認モーダルで削除を実行すると、" do
          Then "プロフィール画像が削除される"
            .And "デフォルトのアイコンが表示される"
        end

        When "確認モーダルでキャンセルすると、" do
          Then "モーダルが閉じる"
            .And "画像は削除されない"
        end
      end
    end
  end

  Scenario "編集のキャンセル" do
    Given "プロフィール編集ページで入力を行ったとき" do
      When "キャンセルボタンをクリックすると、" do
        Then "変更破棄の確認モーダルが表示される"
      end

      When "確認モーダルで破棄を実行すると、" do
        Then "変更が破棄される"
          .And "プロフィールページに遷移する"
      end

      When "確認モーダルでキャンセルすると、" do
        Then "モーダルが閉じる"
          .And "編集ページに戻る"
      end
    end
  end

  Scenario "未ログイン状態でのアクセス" do
    Given "未ログイン状態のとき" do
      When "プロフィール編集ページにアクセスしようとすると、" do
        Then "サインインページにリダイレクトされる"
      end
    end
  end
end
